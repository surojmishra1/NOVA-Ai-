<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NOVA AI Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0;
      background: #1a1a2e;
      font-family: 'Segoe UI', sans-serif;
      color: white;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .header {
      background: #252547;
      padding: 12px;
      text-align: center;
      font-size: 22px;
      font-weight: bold;
      position: relative;
    }

    .menu-container {
      position: absolute;
      top: 12px;
      right: 12px;
    }

    .menu-button {
      cursor: pointer;
      font-size: 22px;
    }

    .menu-dropdown {
      display: none;
      background: #2e2e52;
      border-radius: 6px;
      padding: 8px;
      position: absolute;
      right: 0;
      top: 25px;
      z-index: 10;
    }

    .menu-dropdown div {
      padding: 6px;
      cursor: pointer;
    }

    .menu-dropdown div:hover {
      background: #3d3d6b;
    }

    .chat-box {
      flex: 1;
      overflow-y: auto;
      padding: 12px;
    }

    .message {
      margin: 10px 0;
    }

    .user {
      text-align: right;
      color: #00bfff;
    }

    .bot {
      text-align: left;
      color: #90ee90;
    }

    .bot.greeting {
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .response-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 4px;
    }

    .reaction {
      background: transparent;
      border: none;
      color: white;
      font-size: 18px;
      cursor: pointer;
      padding: 2px 6px;
    }

    .reaction:hover {
      color: #00bfff;
    }

    .action-buttons {
      display: flex;
      justify-content: space-around;
      background: #252547;
      padding: 8px;
      position: sticky;
      bottom: 0;
    }

    .input-box {
      display: flex;
      padding: 10px;
      background: #252547;
      align-items: center;
    }

    input[type="text"] {
      flex: 1;
      padding: 10px;
      font-size: 14px;
      border-radius: 6px;
      border: none;
      margin-right: 6px;
    }

    button {
      padding: 8px;
      background: #00bfff;
      color: white;
      border: none;
      border-radius: 50%;
      font-size: 16px;
      cursor: pointer;
    }

    .loader {
      width: 22px;
      height: 22px;
      border: 3px solid #00bfff;
      border-top: 3px solid transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 8px auto;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
  </style>
</head>
<body>
  <div class="header">
    NOVA AI Chat
    <div class="menu-container">
      <div class="menu-button" onclick="toggleMenu()">&#x22EE;</div>
      <div id="menu" class="menu-dropdown">
        <div onclick="startNewChat()">New Chat</div>
        <div onclick="selectTheme()">Select Theme</div>
      </div>
    </div>
  </div>

  <div id="chat" class="chat-box">
    <div class="message bot greeting">NOVA: Hello! How can I help you today?</div>
  </div>

  <div class="input-box">
    <input type="text" id="input" placeholder="Type a message..." onkeydown="if(event.key==='Enter'){ sendMessage(); }" />
    <button onclick="sendMessage()" title="Send">&#x1F4E7;</button>
  </div>

  <div class="action-buttons" id="actionBtns" style="display: none;">
    <button onclick="regenerateReply()" title="Regenerate">&#x1F501;</button>
    <button onclick="stopChat()" title="Stop Chat">&#x26D4;</button>
  </div>

  <script>
    const apiKey = "AIzaSyC1N4MhOwSoSho4WLWfnsRyNMPmyMbfuaw";
    let isStopped = false;
    let lastUserText = "";

    function toggleMenu() {
      const menu = document.getElementById("menu");
      menu.style.display = menu.style.display === "none" ? "block" : "none";
    }

    function startNewChat() {
      document.getElementById("chat").innerHTML = '<div class="message bot greeting">NOVA: Hello! How can I help you today?</div>';
      isStopped = false;
      toggleMenu();
    }

    function selectTheme() {
      alert("Theme selector coming soon!");
      toggleMenu();
    }

    function addMessage(sender, text, type, isGreeting = false) {
      const msg = document.createElement("div");
      msg.className = `message ${type}` + (isGreeting ? " greeting" : "");
      msg.innerHTML = `<strong>${sender}:</strong> ${text}`;

      document.getElementById("chat").appendChild(msg);
      document.getElementById("chat").scrollTop = document.getElementById("chat").scrollHeight;
      return msg;
    }

    function addLoader() {
      const loader = document.createElement("div");
      loader.className = "loader";
      loader.id = "loader";
      document.getElementById("chat").appendChild(loader);
      document.getElementById("chat").scrollTop = document.getElementById("chat").scrollHeight;
    }

    function removeLoader() {
      const loader = document.getElementById("loader");
      if (loader) loader.remove();
    }

    function showActions() {
      document.getElementById("actionBtns").style.display = "flex";
    }

    async function sendMessage() {
      if (isStopped) {
        alert("Chat is stopped. Tap Regenerate to continue.");
        return;
      }

      const input = document.getElementById("input");
      const text = input.value.trim();
      if (!text) return;

      lastUserText = text;
      input.value = "";

      addMessage("You", text, "user");
      addLoader();

      const res = await fetch(
        `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`,
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            contents: [{ parts: [{ text }] }],
          }),
        }
      );

      const data = await res.json();
      removeLoader();

      const reply = data?.candidates?.[0]?.content?.parts?.[0]?.text || "Sorry, no response.";
      const botMsg = addMessage("NOVA", reply, "bot");
      showActions();

      const buttons = document.createElement("div");
      buttons.className = "response-buttons";
      buttons.innerHTML = `
        <button class="reaction" title="Like">&#x1F44D;</button>
        <button class="reaction" title="Dislike">&#x1F44E;</button>
      `;
      botMsg.appendChild(buttons);
    }

    function stopChat() {
      isStopped = true;
      addMessage("NOVA", "Chat stopped. Tap ♻️ to restart.", "bot");
    }

    function regenerateReply() {
      if (lastUserText) {
        isStopped = false;
        sendMessageAgain(lastUserText);
      }
    }

    async function sendMessageAgain(text) {
      addLoader();

      const res = await fetch(
        `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`,
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            contents: [{ parts: [{ text }] }],
          }),
        }
      );

      const data = await res.json();
      removeLoader();

      const reply = data?.candidates?.[0]?.content?.parts?.[0]?.text || "Sorry, no response.";
      const botMsg = addMessage("NOVA", reply, "bot");
      showActions();

      const buttons = document.createElement("div");
      buttons.className = "response-buttons";
      buttons.innerHTML = `
        <button class="reaction" title="Like">&#x1F44D;</button>
        <button class="reaction" title="Dislike">&#x1F44E;</button>
      `;
      botMsg.appendChild(buttons);
    }
  </script>
</body>
</html>
